<!doctype html><html lang=en-us><head><meta charset=utf-8><title>Add a New DSL | Kaoto</title><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta name=description content="How to add a new Domain Specific Language to Kaoto."><meta name=author content="Kaoto Team"><meta name=generator content="Hugo 0.101.0"><style>:root{--primary-color:#41228e}</style><link rel=stylesheet href=https://kaoto.io/plugins/bootstrap/bootstrap.min.css><link rel=stylesheet href=https://kaoto.io/plugins/slick/slick.css><link rel=stylesheet href=https://kaoto.io/plugins/themify-icons/themify-icons.css><link rel=stylesheet href=https://kaoto.io/css/style.min.css media=screen><link rel=stylesheet href=https://kaoto.io/css/custom.css media=screen><link rel="shortcut icon" href=https://kaoto.io/images/favicon.ico type=image/x-icon><link rel=icon href=https://kaoto.io/images/favicon.ico type=image/x-icon><script async src="https://www.googletagmanager.com/gtag/js?id=G-BP1PVX7HSK"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-BP1PVX7HSK")</script></head><body><div class=preloader><img src=/images/preloader.gif alt=preloader></div><header class="navigation fixed-top"><nav class="navbar navbar-expand-lg navbar-dark"><a class=navbar-brand href=https://kaoto.io/><h3 class="text-white font-tertiary">Kaoto</h3></a><button class=navbar-toggler type=button data-toggle=collapse data-target=#navigation aria-controls=navigation aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse text-center" id=navigation><ul class="navbar-nav ml-auto"><li class=nav-item><a class=nav-link href=https://kaoto.io/></a></li><li class=nav-item><a class=nav-link href=https://kaoto.io/about>About</a></li><li class=nav-item><a class=nav-link href=https://kaoto.io/blog>Blog</a></li><li class=nav-item><a class=nav-link href=https://kaoto.io/quickstart>Quick Start</a></li><li class=nav-item><a class=nav-link href=https://kaoto.io/docs>Docs</a></li><li class=nav-item><a class=nav-link href=https://kaoto.io/portfolio>Use Cases</a></li></ul></div></nav></header><section class="page-title bg-primary position-relative overflow-hidden"><div class=container><div class=row><div class="col-12 text-center"><h1 class="text-white font-tertiary">Add a New DSL</h1></div></div></div><img src=/images/illustrations/page-title.png alt=illustrations class="bg-shape-1 w-100">
<img src=/images/illustrations/leaf-pink-round.svg alt=illustrations class=bg-shape-2>
<img src=/images/illustrations/dots-cyan.svg alt=illustrations class=bg-shape-3>
<img src=/images/illustrations/leaf-orange.svg alt=illustrations class=bg-shape-4>
<img src=/images/illustrations/leaf-yellow.svg alt=illustrations class=bg-shape-5>
<img src=/images/illustrations/dots-group-cyan.svg alt=illustrations class=bg-shape-6>
<img src=/images/illustrations/leaf-cyan-lg.svg alt=illustrations class=bg-shape-7></section><section class=section><div class=container><div class="row justify-content-center"><div class=col-lg-9><div class=content><p>Kaoto&rsquo;s frontend is agnostic of the DSL (Domain Specific Language) used, so to add support for a new DSL we just have to implement the specific endpoints on the <a href=https://kaotoio.github.io/kaoto-backend/api/index.html target=_blank>API</a>
.</p><p>To properly deploy the workflows, Kaoto is expecting the integration to be deployed via a <a href=https://kubernetes.io/docs/tasks/extend-kubernetes/custom-resources/custom-resource-definitions/ target=_blank>CustomResourceDefinition (CRD)</a>
as <a href=https://camel.apache.org/camel-k/ target=_blank>Camel-K</a>
does. You can use other kinds of source code and build integrations with them, but they won&rsquo;t be deployable via Kaoto.</p><h2 id=implementation>Implementation</h2><p>You can use the <a href=https://github.com/KaotoIO/kaoto-backend/tree/main/kamelet-support target=_blank>kamelet-support</a>
project as an example.</p><p>You need to create a new Java Maven project that <a href=https://github.com/KaotoIO/kaoto-backend/blob/main/api/pom.xml#L88-L92 target=_blank>will be added as dependency on the API project</a>
. You will need to add the <a href=https://github.com/KaotoIO/kaoto-backend/blob/main/kamelet-support/pom.xml#L14-L28 target=_blank>model, catalog and services-interfaces dependencies</a>
in your project.</p><p>Your project has to provide implementations for one or more the following services:</p><h3 id=deploymentgeneratorservice>DeploymentGeneratorService</h3><p>This service will translate from the JSON list of steps used by the frontend to visualize graphically the workflow to the source code. By implementing this service, you give Kaoto the ability to &ldquo;translate&rdquo; from graphical to source code.</p><p><img src=/images/docs/kaoto-backend-overview-crd.svg alt="From steps to code" title="From steps to code"></p><p>Your implementation must be <code>@ApplicationScoped</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@ApplicationScoped</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>KameletBindingDeploymentGeneratorService</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>implements</span> DeploymentGeneratorService <span style=color:#f92672>{</span>
</span></span></code></pre></div><p>The <code>identifier()</code> should return a unique string that will be useful to correlate the generated CRD with the type of workflow we are generating.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>public</span> String <span style=color:#a6e22e>identifier</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#34;KameletBinding&#34;</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>The <code>getKinds()</code> must return what steps are this CRD compatible with. Kaoto will try to apply all DeploymentGeneratorServices on all the calls unless we explicitly ask for a specific source code output. The <code>getKinds</code> function is a quick check to know if we should apply this implementation when Kaoto is requested to output source codes.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> List<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>getKinds</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> Arrays<span style=color:#f92672>.</span><span style=color:#a6e22e>asList</span><span style=color:#f92672>(</span><span style=color:#66d9ef>new</span> String<span style=color:#f92672>[]{</span>CAMEL_CONNECTOR<span style=color:#f92672>,</span> KAMELET<span style=color:#f92672>});</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>Then, we need to implement the <code>parse(...)</code> function that will return the CRD content based on the list of steps and a map of metadata.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> String <span style=color:#a6e22e>parse</span><span style=color:#f92672>(</span>List<span style=color:#f92672>&lt;</span>Step<span style=color:#f92672>&gt;</span> steps<span style=color:#f92672>,</span> Map<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>,</span> Object<span style=color:#f92672>&gt;</span> metadata<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#f92672>(!</span>appliesTo<span style=color:#f92672>(</span>steps<span style=color:#f92672>))</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#34;&#34;</span><span style=color:#f92672>;</span> <span style=color:#75715e>//someone tried to apply this service to the wrong list of steps
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>     <span style=color:#f92672>...</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>Finally, the <code>appliesTo(...)</code> function will be used to decide if this service can be applied to the list of steps. Note that this <code>appliesTo</code> function is the one that decides if you will be able to generate the source code or not. If this function returns <code>true</code>, the function <code>parse</code> must return valid source code.</p><h3 id=stepparserservice>StepParserService</h3><p>This service will do the reverse operation as DeploymentGeneratorService: given a CRD, return the list of steps associated to it. By implementing this service, you give Kaoto the ability to &ldquo;translate&rdquo; from the source code to graphic editing.</p><p><img src=/images/docs/kaoto-backend-overview-steps.svg alt="From code to steps" title="From code to steps"></p><p>As the previous one, it must have the <code>@ApplicationScoped</code> annotation.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@ApplicationScoped</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>KameletBindingStepParserService</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>implements</span> StepParserService<span style=color:#f92672>&lt;</span>Step<span style=color:#f92672>&gt;</span> <span style=color:#f92672>{</span>
</span></span></code></pre></div><p>You may want to inject a catalog step.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>private</span> StepCatalog catalog<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Inject</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>setCatalog</span><span style=color:#f92672>(</span><span style=color:#66d9ef>final</span> StepCatalog catalog<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>catalog</span> <span style=color:#f92672>=</span> catalog<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>The <code>parse(...)</code> function will return the list of steps given a string.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> ParseResult<span style=color:#f92672>&lt;</span>Step<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>deepParse</span><span style=color:#f92672>(</span>String input<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#f92672>(!</span>appliesTo<span style=color:#f92672>(</span>input<span style=color:#f92672>))</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> IllegalArgumentException<span style=color:#f92672>(</span>
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#34;Wrong format provided. This is not parseable by us&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>...</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>The <code>ParseResult&lt;T></code> class is an auxiliary class that returns both a list of steps and some metadata that may be helpful to decorate the source code. For example, the name of the integration, or some dependencies.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>ParseResult</span><span style=color:#f92672>&lt;</span>T<span style=color:#f92672>&gt;</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> List<span style=color:#f92672>&lt;</span>T<span style=color:#f92672>&gt;</span> steps<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> Map<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>,</span> Object<span style=color:#f92672>&gt;</span> metadata<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>...</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>And the <code>appliesTo(...)</code> function will also check that the CRD provided is valid for this service.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>boolean</span> <span style=color:#a6e22e>appliesTo</span><span style=color:#f92672>(</span><span style=color:#66d9ef>final</span> String yaml<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> yaml<span style=color:#f92672>.</span><span style=color:#a6e22e>contains</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;kind: KameletBinding&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>Note that this <code>appliesTo</code> function is the one that decides if you will be able to parse the source code or not. If this function returns <code>true</code>, the function <code>parse</code> must return a valid list of steps.</p><h3 id=stepcatalogparser-optional>StepCatalogParser (Optional)</h3><p>Your DSL may have specific steps that needs to be added to the catalog. To add those steps to the general catalog, you have to provide an <code>@ApplicationScoped</code> implementation of the <code>StepCatalogParser</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@ApplicationScoped</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>final</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>KameletParseCatalog</span> <span style=color:#66d9ef>implements</span> StepCatalogParser <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#a6e22e>KameletParseCatalog</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> ParseCatalog<span style=color:#f92672>&lt;</span>Step<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>getParser</span><span style=color:#f92672>(</span><span style=color:#66d9ef>final</span> String url<span style=color:#f92672>,</span> <span style=color:#66d9ef>final</span> String tag<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        ParseCatalog<span style=color:#f92672>&lt;</span>Step<span style=color:#f92672>&gt;</span> parseCatalog <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> GitParseCatalog<span style=color:#f92672>&lt;&gt;(</span>url<span style=color:#f92672>,</span> tag<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        parseCatalog<span style=color:#f92672>.</span><span style=color:#a6e22e>setFileVisitor</span><span style=color:#f92672>(</span><span style=color:#66d9ef>new</span> KameletFileProcessor<span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> parseCatalog<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> ParseCatalog<span style=color:#f92672>&lt;</span>Step<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>getParser</span><span style=color:#f92672>(</span><span style=color:#66d9ef>final</span> String url<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        ParseCatalog<span style=color:#f92672>&lt;</span>Step<span style=color:#f92672>&gt;</span> parseCatalog <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> JarParseCatalog<span style=color:#f92672>&lt;&gt;(</span>url<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        parseCatalog<span style=color:#f92672>.</span><span style=color:#a6e22e>setFileVisitor</span><span style=color:#f92672>(</span><span style=color:#66d9ef>new</span> KameletFileProcessor<span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> parseCatalog<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>Both GitParseCatalog and JarParseCatalog are helper classes that will access the git repository or zip file defined and use a FileVisitor to process the files encountered on them. You don&rsquo;t have to use them in your implementation. The only requirement is to return a <a href=https://github.com/KaotoIO/kaoto-backend/blob/main/metadata/src/main/java/io/kaoto/backend/metadata/ParseCatalog.java target=_blank>ParseCatalog</a>
that will be called when warming up the catalog steps.</p><p>On this case, the <a href=https://github.com/KaotoIO/kaoto-backend/blob/main/kamelet-support/src/main/java/io/kaoto/backend/metadata/parser/step/kamelet/KameletFileProcessor.java target=_blank>KameletFileProcessor</a>
is an auxiliary class that extends <a href=https://github.com/KaotoIO/kaoto-backend/blob/main/metadata/src/main/java/io/kaoto/backend/metadata/parser/YamlProcessFile.java target=_blank>YamlProcessFile</a>
to process Kamelet metadata definitions. You can use any FileProcessor that you find suitable to your use-case.</p><p>If you don&rsquo;t require any FileProcessor, you can leave that property empty. The only mandatory implementation detail about the ParseCatalog instance returned by your StepCatalogParser is that the returned ParseCatalog <code>parse()</code> function returns a list of Steps. You can implement your own ParseCatalog class.</p><p>It may be you are using your own kind of steps, specific for your DSL.</p></div></div></div></div></section><footer class="bg-dark footer-section"><div class=section><div class=container><div class=row><div class=col-md-4><h5 class=text-light>Email</h5><p class="text-white paragraph-lg font-secondary"><a href=mailto:hellokaoto@gmail.com>hellokaoto@gmail.com</a></p></div><div class=col-md-4><h5 class=text-light>Source Code</h5><p class="text-white paragraph-lg font-secondary"><a href=https://github.com/KaotoIO rel="nofollow noopener" target=_blank>KaotoIO</a></p></div><div class=col-md-4><h5 class=text-light>Twitter</h5><p class="text-white paragraph-lg font-secondary"><a href=https://www.twitter.com/KaotoIO rel="nofollow noopener" target=_blank>KaotoIO</a></p></div></div></div></div><div class="footer-bottom border-top text-center border-dark py-5"><p class="mb-0 text-light">Copyright 2022 © Kaoto</p></div></footer><script src=https://kaoto.io/plugins/jQuery/jquery.min.js></script>
<script src=https://kaoto.io/plugins/bootstrap/bootstrap.min.js></script>
<script src=https://kaoto.io/plugins/slick/slick.min.js></script>
<script src=https://kaoto.io/plugins/shuffle/shuffle.min.js></script>
<script src=https://kaoto.io/js/script.min.js></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/js-cookie/2.2.1/js.cookie.min.js></script><div id=js-cookie-box class="cookie-box cookie-box-hide">This site uses cookies. By continuing to use this website, you agree to their use. <span id=js-cookie-button class="btn btn-sm btn-primary ml-2">I Accept</span></div><script>(function(){const t=document.getElementById("js-cookie-box"),n=document.getElementById("js-cookie-button");Cookies.get("cookie-box")||(t.classList.remove("cookie-box-hide"),n.onclick=function(){Cookies.set("cookie-box",!0,{expires:2}),t.classList.add("cookie-box-hide")})})(jQuery)</script><style>.cookie-box{position:fixed;left:0;right:0;bottom:0;text-align:center;z-index:9999;padding:1rem 2rem;background:#474747;transition:all .75s cubic-bezier(.19,1,.22,1);color:#fdfdfd}.cookie-box-hide{display:none}</style></body></html>